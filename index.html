<!DOCTYPE html>

<html lang="es">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Acceso Seguro</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
  @media (max-width: 768px) {
    .note-card { flex-direction: column !important; align-items: flex-start !important; }
    .note-card .items-end { align-self: flex-end; margin-top: 1rem; }
    #pinScreen { padding: 2rem; }
  }
</style>
</head>
<body class="bg-gray-100 flex items-center justify-center h-screen">
<!-- BotÃ³n y menÃº hamburguesa solo visible en mÃ³viles -->
<!-- BotÃ³n cerrar sesiÃ³n solo en escritorio -->
<div class="hidden md:block fixed top-4 right-4 z-50">
<button class="text-gray-700 bg-white p-2 rounded shadow-md hover:bg-gray-100" onclick="logoutApp()"><i class="fas fa-sign-out-alt"></i></button>
</div>

<div class="md:hidden fixed top-4 left-4 z-50">
<button class="text-gray-700 bg-white p-2 rounded shadow-md" onclick="toggleMobileMenu()">
<i class="fas fa-bars fa-lg"></i>
</button>
</div>
<div class="hidden fixed top-16 left-4 bg-white rounded-lg shadow-lg p-4 z-40 space-y-2 w-48" id="mobileMenu">
<button class="w-full text-left px-4 py-2 hover:bg-gray-100 rounded" onclick="document.getElementById('addItemButton').click()">âž• AÃ±adir item</button>
<button class="w-full text-left px-4 py-2 hover:bg-gray-100 rounded" onclick="alert('Ver Todo (pendiente de implementar)')">ðŸ“„ Ver todo</button>
<button class="w-full text-left px-4 py-2 hover:bg-gray-100 rounded" onclick="openMFCModal()">ðŸ›  MFC</button>
</div>
<script>
  function toggleMobileMenu() {
    const menu = document.getElementById("mobileMenu");
    if (menu) menu.classList.toggle("hidden");
  }
</script>
<div class="fixed inset-0 flex items-center justify-center bg-white z-50" id="loader">
<div class="text-center space-y-4">
<svg class="animate-spin h-10 w-10 text-blue-600 mx-auto" fill="none" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
<circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
<path class="opacity-75" d="M4 12a8 8 0 018-8v8z" fill="currentColor"></path>
</svg>
<p class="text-gray-700 text-lg font-medium">Cargandoâ€¦</p>
</div>
</div>
<div class="text-center space-y-6" id="pinScreen">
<h1 class="text-2xl font-bold">Introduce el PIN para acceder</h1>
<input class="px-4 py-2 border rounded text-center text-xl" id="pinInput" maxlength="4" placeholder="PIN" type="password"/>
<div>
<button class="mt-4 bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700" onclick="checkPIN()">Entrar</button>
</div>
<p class="text-red-500 font-medium hidden" id="errorMsg">PIN incorrecto</p>
</div>
<div id="appContent" style="display: none;">
<!DOCTYPE html>

<html lang="es">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Mikel</title>
<script src="https://cdn.tailwindcss.com"></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&amp;display=swap" rel="stylesheet"/>
<link crossorigin="anonymous" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" referrerpolicy="no-referrer" rel="stylesheet"/>
<style>
        body { font-family: 'Inter', sans-serif; background-color: #f8f9fa; }
        .main-search-container { min-height: calc(100vh - 200px); display: flex; align-items: center; justify-content: center; }
        /* Estilo de etiquetas mejorado */
        .tag {
            background-color: #4f46e5;
            color: white;
            padding: 0.25rem 0.6rem;
            border-radius: 9999px;
            font-size: 0.8rem;
            font-weight: 500;
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
            transition: all 0.2s ease-in-out;
            background-image: linear-gradient(to right, #4f46e5, #8b5cf6);
        }
        .tag:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1);
        }
        .note-card { transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out; }
        .note-card:hover { transform: translateY(-5px); box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.07), 0 4px 6px -4px rgb(0 0 0 / 0.07); }
        .modal { display: none; opacity: 0; transition: opacity 0.3s ease; }
        .modal.active { display: flex; opacity: 1; }
        .modal-content { transform: scale(0.95); transition: transform 0.3s ease; }
        .modal.active .modal-content { transform: scale(1); }
        input[type="file"] { display: none; }
        #toast-container { position: fixed; top: 20px; right: 20px; z-index: 100; }
        .toast { display: flex; align-items: center; padding: 1rem 1.5rem; border-radius: 0.5rem; box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1); opacity: 0; transform: translateX(100%); transition: all 0.3s ease-in-out; }
        .toast.show { opacity: 1; transform: translateX(0); }
        .toast.success { background-color: #d1fae5; color: #065f46; }
        .toast.error { background-color: #fee2e2; color: #991b1b; }
        .search-results-container { min-height: 200px; display: flex; flex-direction: column; justify-content: center; align-items: center; }
        .search-results-list { width: 100%; max-width: 800px; }
        .search-result-item { background-color: white; border: 1px solid #e2e8f0; padding: 16px; margin-bottom: 16px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        .mobile-menu {
            transition: transform 0.3s ease-in-out;
            transform: translateX(100%);
        }
        .mobile-menu.active {
            transform: translateX(0);
        }
        /* Oculta el menÃº desplegable por defecto */
        .dropdown-menu {
            display: none;
        }
        /* Muestra el menÃº cuando tiene la clase 'active' */
        .dropdown-menu.active {
            display: block;
        }
    </style>
</head>
<body class="antialiased text-gray-800">
<script src="https://www.gstatic.com/firebasejs/10.4.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.4.0/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.4.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.4.0/firebase-storage-compat.js"></script>
<script>
        const firebaseConfig = {
            apiKey: "AIzaSyA26sad8msWrNTVByMs8umSUV_OJsqctuE",
            authDomain: "mikelaneako.firebaseapp.com",
            projectId: "mikelaneako",
            storageBucket: "mikelaneako.firebasestorage.app",
            messagingSenderId: "261413636045",
            appId: "1:261413636045:web:717b7e87d84a345e816684"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const storage = firebase.storage();
        const auth = firebase.auth();
        let allNotes = [];
        let DOM = {};
        
        window.onload = () => {
            initializeDOMElements();
            setupEventListeners();
            auth.signInAnonymously().then(() => {
                DOM.appHeader.classList.remove('hidden');
                DOM.appMain.classList.remove('hidden');
                showView('search');
                loadNotes();
            }).catch((error) => {
                console.error("Error al iniciar sesiÃ³n anÃ³nimamente:", error);
                showToast("Error de autenticaciÃ³n. La aplicaciÃ³n puede no funcionar correctamente.", "error");
                DOM.appHeader.classList.remove('hidden');
                DOM.appMain.classList.remove('hidden');
                showView('search');
            });
        };

        function initializeDOMElements() {
            DOM = {
                appHeader: document.getElementById('app-header'),
                appMain: document.getElementById('app-main'),
                mainSearchView: document.getElementById('main-search-view'),
                allItemsView: document.getElementById('all-items-view'),
                notesContainer: document.getElementById('notes-container'),
                searchInput: document.getElementById('searchInput'),
                mainSearchInput: document.getElementById('mainSearchInput'),
                mainSearchButton: document.getElementById('mainSearchButton'),
                loadingIndicator: document.getElementById('loading-indicator'),
                noNotesMessage: document.getElementById('no-notes-message'),
                noResultsMessage: document.getElementById('no-results-message'),
                logoButton: document.getElementById('logoButton'),
                viewAllButton: document.getElementById('viewAllButton'),
                mfcButton: document.getElementById('mfcButton'),
                mfcModal: document.getElementById('mfcModal'),
                addItemButtonHeader: document.getElementById('addItemButtonHeader'),
                addNoteModal: document.getElementById('addNoteModal'),
                addNoteForm: document.getElementById('addNoteForm'),
                modalTitle: document.getElementById('modalTitle'),
                noteIdToEdit: document.getElementById('noteIdToEdit'),
                noteTitleInput: document.getElementById('noteTitle'),
                noteContentInput: document.getElementById('noteContent'),
                
                noteAttachmentInput: document.getElementById('noteAttachment'),
                noteAttachmentLabel: document.getElementById('noteAttachmentLabel'),
                fileChosenContainer: document.getElementById('file-chosen-container'),
                fileChosenName: document.getElementById('file-chosen-name'),
                removeFileButton: document.getElementById('removeFileButton'),
                saveNoteButton: document.getElementById('saveNoteButton'),
                confirmationModal: document.getElementById('confirmationModal'),
                confirmationMessage: document.getElementById('confirmationMessage'),
                confirmButton: document.getElementById('confirmButton'),
                cancelButton: document.getElementById('cancelButton'),
                toastContainer: document.getElementById('toast-container'),
                webSearchDropdownBtn: document.getElementById('webSearchDropdownBtn'),
                webSearchDropdownMenu: document.getElementById('webSearchDropdownMenu'),
                menuToggleBtn: document.getElementById('menuToggleBtn'),
                mobileMenu: document.getElementById('mobileMenu'),
                closeMobileMenuBtn: document.getElementById('closeMobileMenuBtn'),
            };
        }

        function setupEventListeners() {
            DOM.logoButton.addEventListener('click', () => showView('search'));
            DOM.viewAllButton.addEventListener('click', () => { DOM.searchInput.value = ''; renderNotes(allNotes); showView('items'); });
            DOM.mfcButton.addEventListener('click', () => toggleModal('mfcModal', true));
            DOM.mainSearchButton.addEventListener('click', () => performSearch(DOM.mainSearchInput.value, 'db'));
            DOM.mainSearchInput.addEventListener('keypress', (e) => { if (e.key === 'Enter') performSearch(DOM.mainSearchInput.value, 'db'); });
            DOM.searchInput.addEventListener('input', () => filterNotes(DOM.searchInput.value));
            DOM.addItemButtonHeader.addEventListener('click', () => openAddModal());
            document.querySelectorAll('.modal-close').forEach(btn => btn.addEventListener('click', () => toggleModal(btn.dataset.modal, false)));
            DOM.saveNoteButton.addEventListener('click', saveNote);
            DOM.noteAttachmentInput.addEventListener('change', handleFileSelect);
            DOM.removeFileButton.addEventListener('click', removeSelectedFile);
            DOM.cancelButton.addEventListener('click', () => toggleModal('confirmationModal', false));
            // Toggle dropdown menu
            DOM.webSearchDropdownBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                DOM.webSearchDropdownMenu.classList.toggle('active');
            });
            document.addEventListener('click', (e) => {
                if (!DOM.webSearchDropdownBtn.contains(e.target) && !DOM.webSearchDropdownMenu.contains(e.target)) {
                    DOM.webSearchDropdownMenu.classList.remove('active');
                }
            });
            // Event listeners para los botones del dropdown
            document.getElementById('dropdown-copytech-btn').addEventListener('click', (e) => {
                performSearch(DOM.mainSearchInput.value, 'copytech');
                DOM.webSearchDropdownMenu.classList.remove('active');
            });
            document.getElementById('dropdown-printcopy-btn').addEventListener('click', (e) => {
                performSearch(DOM.mainSearchInput.value, 'printcopy');
                DOM.webSearchDropdownMenu.classList.remove('active');
            });
            document.getElementById('dropdown-google-btn').addEventListener('click', (e) => {
                performSearch(DOM.mainSearchInput.value, 'google');
                DOM.webSearchDropdownMenu.classList.remove('active');
            });

            if (DOM.menuToggleBtn) DOM.menuToggleBtn.addEventListener('click', () => DOM.mobileMenu.classList.add('active'));
            if (DOM.closeMobileMenuBtn) DOM.closeMobileMenuBtn.addEventListener('click', () => DOM.mobileMenu.classList.remove('active'));
        }

        function showView(viewName) {
            DOM.mainSearchView.classList.toggle('hidden', viewName !== 'search');
            DOM.allItemsView.classList.toggle('hidden', viewName !== 'items');
        }

        function performSearch(searchTerm, type) {
            if (!searchTerm) {
                showToast("Introduce un tÃ©rmino de bÃºsqueda.", "error");
                return;
            }
            if (type === 'db') {
                filterNotes(searchTerm);
                showView('items');
            } else {
                let searchUrl;
                if (type === 'copytech') {
                    searchUrl = `https://www.google.com/search?q=${encodeURIComponent(searchTerm)}+site:copytechnet.com`;
                } else if (type === 'printcopy') {
                    searchUrl = `https://www.google.com/search?q=${encodeURIComponent(searchTerm)}+site:printcopy.info`;
                } else { // type === 'google'
                    searchUrl = `https://www.google.com/search?q=${encodeURIComponent(searchTerm)}`;
                }
                window.location.href = searchUrl;
            }
        }
        
        // Las funciones de IA se han eliminado del cÃ³digo, solo para evitar errores.
        
        function improveContentWithAI() {
            showToast("Funcionalidad IA no implementada en esta versiÃ³n.", "error");
        }

        function suggestTagsWithAI() {
            showToast("Funcionalidad IA no implementada en esta versiÃ³n.", "error");
        }

        function toggleModal(modalId, show) {
            const modal = document.getElementById(modalId);
            if (modal) {
                if (show) modal.classList.add('active');
                else modal.classList.remove('active');
                if (!show && modalId === 'addNoteModal') resetAddNoteForm();
            }
        }
        
        function openAddModal() {
            resetAddNoteForm();
            DOM.modalTitle.textContent = "AÃ±adir Nuevo Item";
            toggleModal('addNoteModal', true);
        }

        function openEditModal(note) {
            resetAddNoteForm();
            DOM.modalTitle.textContent = "Editar Item";
            DOM.noteIdToEdit.value = note.id;
            DOM.noteTitleInput.value = note.titulo;
            DOM.noteContentInput.value = note.descripcion;
                        if (note.fileURL) {
                const fileName = note.fileURL.substring(note.fileURL.lastIndexOf('/') + 1);
                showSelectedFile(fileName);
            }
            toggleModal('addNoteModal', true);
        }

        function resetAddNoteForm() {
            DOM.addNoteForm.reset();
            DOM.noteIdToEdit.value = '';
            removeSelectedFile();
        }

        function handleFileSelect(e) {
            const file = e.target.files[0];
            if (file) showSelectedFile(file.name);
        }

        function showSelectedFile(fileName) {
            DOM.fileChosenName.textContent = fileName;
            DOM.fileChosenContainer.classList.remove('hidden');
            DOM.noteAttachmentLabel.classList.add('hidden');
        }

        function removeSelectedFile() {
            DOM.noteAttachmentInput.value = '';
            DOM.fileChosenContainer.classList.add('hidden');
            DOM.noteAttachmentLabel.classList.remove('hidden');
        }
        
        async function uploadFile(file) {
            if (!file) return null;
            const storageRef = storage.ref("adjuntos/" + Date.now() + "-" + file.name);
            await storageRef.put(file);
            const downloadURL = await storageRef.getDownloadURL();
            return { url: downloadURL, path: "adjuntos/" + Date.now() + "-" + file.name, name: file.name };
        }

        // --- CRUD OPERATIONS ---
        function loadNotes() {
            DOM.loadingIndicator.classList.remove('hidden');
            db.collection("notas").orderBy("fecha", "desc").onSnapshot((snapshot) => {
                allNotes = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                renderNotes(allNotes); 
                DOM.loadingIndicator.classList.add('hidden');
            }, (error) => {
                console.error("Error al cargar las notas: ", error);
                showToast("Error al cargar las notas.", "error");
                DOM.loadingIndicator.classList.add('hidden');
            });
        }

        async function saveNote() {
            const title = DOM.noteTitleInput.value.trim();
            const content = DOM.noteContentInput.value.trim();
                        const noteId = DOM.noteIdToEdit.value;

            if (title === '' || content === '') {
                showToast('El tÃ­tulo y el contenido son obligatorios.', 'error');
                return;
            }

            DOM.saveNoteButton.disabled = true;
            DOM.saveNoteButton.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Guardando...';

            try {
                let fileURL = null;
                let filePath = null;
                let fileName = null;

                if (file) {
                    const attachment = await uploadFile(file);
                    if (attachment) {
                        fileURL = attachment.url;
                        filePath = attachment.path;
                        fileName = attachment.name;
                    } else {
                        throw new Error("Error al subir el archivo adjunto.");
                    }
                } else if (noteId && !DOM.fileChosenContainer.classList.contains('hidden')) {
                    const existingNote = allNotes.find(n => n.id === noteId);
                    if (existingNote) {
                        fileURL = existingNote.fileURL;
                        filePath = existingNote.filePath; 
                        fileName = existingNote.fileName; 
                    }
                } else if (noteId && DOM.fileChosenContainer.classList.contains('hidden')) {
                    const existingNote = allNotes.find(n => n.id === noteId);
                    if (existingNote && existingNote.filePath) { 
                        const oldStorageRef = storage.ref(existingNote.filePath);
                        await oldStorageRef.delete().catch(err => console.warn("Archivo antiguo no encontrado o no pudo ser eliminado.", err));
                    }
                    fileURL = null;
                    filePath = null;
                    fileName = null;
                }

                const noteData = { 
                    titulo: title,
                    descripcion: content,
                    
                    fileURL: fileURL,
                    filePath: filePath,
                    fileName: fileName,
                    fecha: firebase.firestore.Timestamp.fromDate(new Date())
                };

                if (noteId) {
                    await db.collection("notas").doc(noteId).update(noteData);
                    showToast("Item actualizado.", "success");
                } else {
                    await db.collection("notas").add(noteData);
                    showToast("Item aÃ±adido.", "success");
                }
                toggleModal('addNoteModal', false);
            } catch (error) {
                console.error("Error al guardar la nota:", error);
                showToast("No se pudo guardar la nota. Revisa la consola para mÃ¡s detalles.", "error");
            } finally {
                DOM.saveNoteButton.disabled = false;
                DOM.saveNoteButton.innerHTML = 'Guardar Item';
            }
        }

        function confirmDelete(noteId) {
            showConfirmationModal("Â¿Seguro que quieres eliminar esta nota? No se puede deshacer.", () => deleteNote(noteId));
        }
        
        async function deleteNote(noteId) {
            try {
                const noteRef = db.collection("notas").doc(noteId);
                const noteDoc = await noteRef.get();
                if (noteDoc.exists && noteDoc.data().filePath) {
                    const storageRef = storage.ref(noteDoc.data().filePath);
                    await storageRef.delete().catch(err => console.warn("Archivo no encontrado o no pudo ser eliminado del almacenamiento.", err));
                }
                await noteRef.delete();
                showToast("Nota eliminada.", "success");
            } catch (error) {
                console.error("Error al eliminar la nota: ", error);
                showToast('No se pudo eliminar la nota.', 'error');
            }
        }

        // --- RENDERING & UI ---
        function renderNotes(notes) {
            DOM.notesContainer.innerHTML = '';
            DOM.noResultsMessage.classList.toggle('hidden', notes.length > 0 || DOM.searchInput.value === '');
            DOM.noNotesMessage.classList.toggle('hidden', allNotes.length > 0);
            notes.forEach(note => {
                const noteElement = document.createElement('div');
                noteElement.className = 'note-card bg-white p-6 rounded-xl shadow-sm border border-gray-200 flex flex-col';
                const tagsHTML = '';
            });
            document.querySelectorAll('.delete-note-btn').forEach(b => b.addEventListener('click', (e) => { e.stopPropagation(); confirmDelete(e.currentTarget.dataset.id); }));
            document.querySelectorAll('.edit-note-btn').forEach(b => b.addEventListener('click', (e) => { e.stopPropagation(); const note = allNotes.find(n=>n.id===e.currentTarget.dataset.id); if(note) openEditModal(note); }));
        }

        function filterNotes(searchTerm) {
            const term = searchTerm.toLowerCase();
            DOM.searchInput.value = term;
            DOM.mainSearchInput.value = term;
            const filtered = allNotes.filter(n => n.titulo.toLowerCase().includes(term) || n.descripcion.toLowerCase().includes(term) || (n.tags && n.tags.some(t => t.toLowerCase().includes(term))) || (n.fileName && n.fileName.toLowerCase().includes(term)));
            renderNotes(filtered);
        }
        
        // --- UTILITIES ---
        function escapeHTML(str) { 
            const div = document.createElement('div');
            div.appendChild(document.createTextNode(str));
            return div.innerHTML;
        }

        function showConfirmationModal(message, onConfirmCallback) {
            DOM.confirmationMessage.textContent = message;
            const newConfirmButton = DOM.confirmButton.cloneNode(true);
            DOM.confirmButton.parentNode.replaceChild(newConfirmButton, DOM.confirmButton);
            DOM.confirmButton = newConfirmButton;
            DOM.confirmButton.onclick = () => { toggleModal('confirmationModal', false); onConfirmCallback(); };
            toggleModal('confirmationModal', true);
        }

        function showToast(message, type = 'success') {
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.innerHTML = `<i class="fas ${type === 'success' ? 'fa-check-circle' : 'fa-exclamation-triangle'} mr-3"></i> ${message}`;
            DOM.toastContainer.appendChild(toast);
            setTimeout(() => toast.classList.add('show'), 10);
            setTimeout(() => {
                toast.classList.remove('show');
                toast.addEventListener('transitionend', () => toast.remove());
            }, 4000);
        }
    </script>
<header class="bg-white/80 backdrop-blur-lg sticky top-0 z-40 border-b border-gray-200 hidden" id="app-header">
<div class="container mx-auto px-4 sm:px-6 lg:px-8">
<div class="flex items-center justify-between h-16">
<div class="flex items-center">
<button class="flex items-center gap-2 text-xl font-bold text-gray-800" id="logoButton"><span class="bg-gray-800 text-white rounded-md w-7 h-7 flex items-center justify-center"><i class="fa-solid fa-plus"></i></span> Mikel</button>
</div>
<nav class="hidden md:flex items-center gap-3">
<button class="flex items-center gap-2 px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50" id="viewAllButton">
<i class="fa-solid fa-list"></i> Ver Todo
                    </button>
<button class="flex items-center gap-2 px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50" id="mfcButton">
<i class="fa-solid fa-download"></i> Recursos
                    </button>
<button class="flex items-center gap-2 px-4 py-2 text-sm font-medium text-white bg-gray-800 rounded-md hover:bg-gray-900" id="addItemButtonHeader">
<i class="fa-solid fa-plus"></i> AÃ±adir Item
                    </button>
</nav>
<button class="md:hidden text-gray-700 text-2xl" id="menuToggleBtn">
<i class="fas fa-bars"></i>
</button>
</div>
</div>
</header>
<div class="fixed top-0 right-0 h-full w-64 bg-white shadow-lg p-6 z-50 mobile-menu md:hidden" id="mobileMenu">
<div class="flex justify-between items-center mb-6">
<h3 class="text-xl font-bold">MenÃº</h3>
<button class="text-gray-700 text-2xl" id="closeMobileMenuBtn"><i class="fas fa-times"></i></button>
</div>
<div class="flex flex-col space-y-4">
<button class="flex items-center gap-2 px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50" id="mobileViewAllButton" onclick="document.getElementById('viewAllButton').click(); DOM.mobileMenu.classList.remove('active');">
<i class="fa-solid fa-list"></i> Ver Todo
            </button>
<button class="flex items-center gap-2 px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50" id="mobileMfcButton" onclick="document.getElementById('mfcButton').click(); DOM.mobileMenu.classList.remove('active');">
<i class="fa-solid fa-download"></i> Recursos
            </button>
<button class="flex items-center gap-2 px-4 py-2 text-sm font-medium text-white bg-gray-800 rounded-md hover:bg-gray-900" id="mobileAddItemButton" onclick="document.getElementById('addItemButtonHeader').click(); DOM.mobileMenu.classList.remove('active');">
<i class="fa-solid fa-plus"></i> AÃ±adir Item
            </button>
</div>
</div>
<main class="container mx-auto p-4 sm:p-6 lg:p-8 hidden" id="app-main">
<div id="toast-container"></div>
<div id="main-search-view">
<div class="main-search-container">
<div class="text-center w-full max-w-2xl">
<div class="flex justify-center items-center gap-3 mb-6"><span class="bg-white border-2 border-gray-200 rounded-2xl w-16 h-16 flex items-center justify-center text-2xl"><i class="fa-solid fa-plus"></i></span></div>
<h1 class="text-5xl font-bold text-gray-800 mb-8">Mikel</h1>
<div class="relative w-full shadow-lg rounded-full flex">
<input class="flex-grow pl-6 pr-4 py-4 border border-gray-200 rounded-l-full focus:ring-2 focus:ring-blue-500 focus:border-blue-500" id="mainSearchInput" placeholder="Busca en tus notas o en la red..." type="text"/>
<button class="px-6 bg-gray-800 text-white hover:bg-gray-900 transition-colors" id="mainSearchButton">Buscar</button>
<div class="relative">
<button class="px-6 bg-blue-600 text-white rounded-r-full hover:bg-blue-700 transition-colors h-full flex items-center gap-2" id="webSearchDropdownBtn">
                                Web <i class="fas fa-caret-down"></i>
</button>
<div class="dropdown-menu absolute right-0 mt-2 py-2 w-48 bg-white rounded-md shadow-xl z-20" id="webSearchDropdownMenu">
<a class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100" data-type="copytech" href="#" id="dropdown-copytech-btn">Copytechnet</a>
<a class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100" data-type="printcopy" href="#" id="dropdown-printcopy-btn">Printcopy.info</a>
<a class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100" data-type="google" href="#" id="dropdown-google-btn">Google General</a>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="hidden" id="all-items-view">
<div class="flex justify-between items-center mb-6">
<h2 class="text-2xl font-bold">Base de Conocimiento</h2>
<div class="relative w-full max-w-xs">
<input class="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" id="searchInput" placeholder="Filtrar resultados..." type="text"/>
<div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"><i class="fas fa-search text-gray-400"></i></div>
</div>
</div>
<div class="text-center py-10" id="loading-indicator"><i class="fas fa-spinner fa-spin fa-3x text-blue-500"></i><p class="mt-2 text-gray-600">Cargando notas...</p></div>
<div class="text-center py-10 bg-white rounded-lg shadow-sm hidden" id="no-notes-message"><i class="fas fa-folder-open fa-3x text-gray-400"></i><p class="mt-4 text-xl font-semibold text-gray-700">No hay items todavÃ­a.</p><p class="text-gray-500">Usa el botÃ³n "AÃ±adir Item" para empezar.</p></div>
<div class="text-center py-10 bg-white rounded-lg shadow-sm hidden" id="no-results-message"><i class="fas fa-search-minus fa-3x text-gray-400"></i><p class="mt-4 text-xl font-semibold text-gray-700">No se encontraron resultados.</p><p class="text-gray-500">Prueba con otros tÃ©rminos de bÃºsqueda.</p></div>
<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="notes-container"></div>
</div>
</main>
<div class="modal fixed inset-0 bg-gray-900 bg-opacity-75 items-center justify-center p-4 z-50" id="addNoteModal">
<div class="modal-content bg-white rounded-xl shadow-2xl w-full max-w-2xl transform transition-all">
<div class="flex justify-between items-center p-5 border-b border-gray-200"><h3 class="text-2xl font-bold text-gray-800" id="modalTitle">AÃ±adir Nuevo Item</h3><button class="modal-close text-gray-400 hover:text-gray-600" data-modal="addNoteModal"><i class="fas fa-times fa-2x"></i></button></div>
<form id="addNoteForm" onsubmit="return false;">
<input id="noteIdToEdit" type="hidden"/>
<div class="p-6 space-y-4">
<div><label class="block text-sm font-medium text-gray-700 mb-1" for="noteTitle">TÃ­tulo</label><input class="w-full border border-gray-300 rounded-lg p-2 focus:ring-2 focus:ring-blue-500" id="noteTitle" type="text"/></div>
<div>
<div class="flex justify-between items-center mb-1">
<label class="block text-sm font-medium text-gray-700" for="noteContent">Contenido</label>
</div>
<textarea class="w-full border border-gray-300 rounded-lg p-2 focus:ring-2 focus:ring-blue-500" id="noteContent" rows="8"></textarea>
</div>

</div>
</form>
<div class="bg-gray-50 p-5 flex justify-end rounded-b-xl"><button class="bg-gray-800 text-white font-bold py-2 px-6 rounded-lg hover:bg-gray-900 transition-colors flex items-center gap-2" id="saveNoteButton">Guardar Item</button></div>
</div>
</div>
<div class="modal fixed inset-0 bg-gray-900 bg-opacity-75 items-center justify-center p-4 z-50" id="mfcModal">
<div class="modal-content bg-white rounded-xl shadow-2xl w-full max-w-lg transform transition-all">
<div class="flex justify-between items-center p-5 border-b border-gray-200"><h3 class="text-2xl font-bold text-gray-800">Recursos</h3><button class="modal-close text-gray-400 hover:text-gray-600" data-modal="mfcModal"><i class="fas fa-times fa-2x"></i></button></div>
<div class="p-6">
<ul class="space-y-4">
<li><a class="flex items-center gap-3 text-blue-600 hover:text-blue-800 hover:underline" download="" href="MFC.msi"><i class="fas fa-file-archive fa-fw text-lg"></i><span class="font-medium">MFC.msi</span></a></li>
<li><a class="flex items-center gap-3 text-blue-600 hover:text-blue-800 hover:underline" download="" href="mfc.exe"><i class="fas fa-file-code fa-fw text-lg"></i><span class="font-medium">mfc.exe</span></a></li>
<li><a class="flex items-center gap-3 text-green-600 hover:text-green-800 hover:underline" href="https://mfc.maquelsa.com/mfc3/access.php" rel="noopener noreferrer" target="_blank"><i class="fas fa-external-link-alt fa-fw text-lg"></i><span class="font-medium">Acceso Web 1 (Maquelsa)</span></a></li>
<li><a class="flex items-center gap-3 text-green-600 hover:text-green-800 hover:underline" href="https://mirror1.infodesain.com/nodeprint/access.php" rel="noopener noreferrer" target="_blank"><i class="fas fa-external-link-alt fa-fw text-lg"></i><span class="font-medium">Acceso Web 2 (Mirror)</span></a></li>
</ul>
<p class="mt-6 text-sm text-yellow-700 bg-yellow-100 p-3 rounded-md"><i class="fas fa-exclamation-triangle mr-2"></i><strong>Importante:</strong> Los ficheros descargables son de ejemplo. Debes actualizarlos con tus propias URLs.</p>
</div>
</div>
</div>
<div class="modal fixed inset-0 bg-gray-900 bg-opacity-75 items-center justify-center p-4 z-50" id="confirmationModal">
<div class="modal-content bg-white rounded-xl shadow-2xl w-full max-w-md transform transition-all">
<div class="p-6 text-center"><i class="fas fa-exclamation-triangle fa-3x text-yellow-400 mb-4"></i><h3 class="text-xl font-bold text-gray-800">ConfirmaciÃ³n Requerida</h3><p class="text-gray-600 my-4" id="confirmationMessage">Â¿EstÃ¡s seguro?</p></div>
<div class="bg-gray-50 p-4 flex justify-center gap-4 rounded-b-xl"><button class="px-6 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50" id="cancelButton">Cancelar</button><button class="px-6 py-2 text-sm font-medium text-white bg-red-600 rounded-md hover:bg-red-700" id="confirmButton">Confirmar</button></div>
</div>
</div>
</body>
</html>
</div>
<script>
    function checkPIN() {
      const pin = document.getElementById("pinInput").value;
      if (pin === "2548") {
        document.getElementById("pinScreen").style.display = "none";
        document.getElementById("appContent").style.display = "block";
      } else {
        document.getElementById("errorMsg").classList.remove("hidden");
      }
    }
  </script>
<script>
  window.addEventListener("load", () => {
    const loader = document.getElementById("loader");
    if (loader) loader.style.display = "none";
  });
</script>

<script>
  function logoutApp() {
    document.getElementById("appContent").style.display = "none";
    document.getElementById("pinScreen").style.display = "block";
    document.getElementById("pinInput").value = "";
    document.getElementById("errorMsg").classList.add("hidden");
  }
</script>
</body>
</html>